<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Secret Santa - Tirage + Email</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        textarea { width: 100%; height: 120px; }
        .file-links { margin-top: 20px; }
        a { display: block; margin-bottom: 6px; color: darkblue; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ… Secret Santa â€“ Fichiers + Emails prÃªts</h1>
    <p>Entrez un nom et une adresse e-mail par ligne, sÃ©parÃ©s par un <code>:</code> :</p>
    <textarea id="namesInput" placeholder="Alice : alice@email.com&#10;Bob : bob@email.com"></textarea><br><br>
    <button onclick="genererFichiers()">GÃ©nÃ©rer les fichiers et emails</button>

    <div class="file-links" id="fileLinks"></div>

    <script>
        function genererFichiers() {
            const input = document.getElementById("namesInput").value;
            const lines = input.split("\n").map(line => line.trim()).filter(line => line !== "");
            const participants = [];

            for (const line of lines) {
                const [name, email] = line.split(":").map(part => part.trim());
                if (!name || !email || !email.includes("@")) {
                    alert("Format invalide : utilisez Nom : email@example.com");
                    return;
                }
                participants.push({ name, email });
            }

            if (participants.length < 2) {
                alert("Il faut au moins deux participants.");
                return;
            }

            // Tirage alÃ©atoire sans auto-attribution
            let shuffled;
            do {
                shuffled = [...participants].sort(() => Math.random() - 0.5);
            } while (shuffled.some((p, i) => p.name === participants[i].name));

            const fileLinksDiv = document.getElementById("fileLinks");
            fileLinksDiv.innerHTML = "<h2>ğŸ“„ Fichiers et emails :</h2>";

            participants.forEach((giver, i) => {
                const recipient = shuffled[i];
                const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Secret Santa pour ${giver.name}</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; padding: 50px; background: #f9f9f9; }
        .card {
            border: 2px dashed #c62828;
            padding: 30px;
            background: #fff8e1;
            max-width: 500px;
            margin: auto;
            border-radius: 10px;
        }
        h1 { color: #c62828; }
        p { font-size: 18px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ… Secret Santa ğŸ</h1>
        <p><strong>${giver.name}</strong>, tu dois offrir un cadeau Ã  :</p>
        <h2>${recipient.name}</h2>
        <p>Garde Ã§a secret ğŸ¤«</p>
        <p>Joyeux NoÃ«l ! ğŸ„</p>
    </div>
</body>
</html>
                `;

                // CrÃ©ation du fichier HTML
                const blob = new Blob([htmlContent], { type: "text/html" });
                const url = URL.createObjectURL(blob);

                const downloadLink = document.createElement("a");
                downloadLink.href = url;
                downloadLink.download = `Secret_Santa_${giver.name}.html`;
                downloadLink.innerText = `ğŸ“¥ TÃ©lÃ©charger pour ${giver.name}`;
                fileLinksDiv.appendChild(downloadLink);

                // Lien mailto prÃ©rempli (sans piÃ¨ce jointe)
                const subject = encodeURIComponent("ğŸ… Ton tirage Secret Santa !");
                const body = encodeURIComponent(`Bonjour ${giver.name},\n\nVoici le rÃ©sultat de ton tirage Secret Santa. Tu peux tÃ©lÃ©charger ton fichier ici :\n${url}\n\nN'oublie pas de garder le secret ğŸ˜‰\n\nJoyeux NoÃ«l ! ğŸ„`);
                const mailtoLink = document.createElement("a");
                mailtoLink.href = `mailto:${giver.email}?subject=${subject}&body=${body}`;
                mailtoLink.innerText = `âœ‰ï¸ Envoyer Ã  ${giver.name}`;
                fileLinksDiv.appendChild(mailtoLink);
            });
        }
    </script>
</body>
</html>
