<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Secret Santa - Tirage + Lien vers tirages</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f5f5f5;
        }
        textarea {
            width: 100%;
            height: 140px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            background-color: #d32f2f;
            color: white;
            border: none;
            cursor: pointer;
        }
        .file-links {
            margin-top: 30px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        a {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1565c0;
        }
        h1, h2 {
            color: #b71c1c;
        }
    </style>
</head>
<body>
    <h1>ğŸ… Secret Santa â€“ GÃ©nÃ©rateur de tirage + Fichiers</h1>

    <p>Entrez un nom et une adresse e-mail par ligne, sÃ©parÃ©s par <code>:</code> :</p>
    <textarea id="namesInput" placeholder="Alice : alice@email.com&#10;Bob : bob@email.com"></textarea><br>
    <button onclick="genererFichiers()">GÃ©nÃ©rer les fichiers et emails</button>

    <div class="file-links" id="fileLinks"></div>

    <hr>

    <div class="file-links" id="hostedLinksContainer">
        <!-- Les liens seront ajoutÃ©s dynamiquement ici -->
    </div>

    <script>
        function genererFichiers() {
            const githubBaseURL = "http://it-testeur.github.io/betterave.cloud/tirages/"; // Remplace par ton URL GitHub Pages

            const input = document.getElementById("namesInput").value;
            const lines = input.split("\n").map(line => line.trim()).filter(line => line !== "");
            const participants = [];

            for (const line of lines) {
                const [name, email] = line.split(":").map(part => part.trim());
                if (!name || !email || !email.includes("@")) {
                    alert("Format invalide : utilisez Nom : email@example.com");
                    return;
                }
                participants.push({ name, email });
            }

            if (participants.length < 2) {
                alert("Il faut au moins deux participants.");
                return;
            }

            let shuffled;
            do {
                shuffled = [...participants].sort(() => Math.random() - 0.5);
            } while (shuffled.some((p, i) => p.name === participants[i].name));

            const fileLinksDiv = document.getElementById("fileLinks");
            fileLinksDiv.innerHTML = "<h2>ğŸ“„ Fichiers et emails Ã  tÃ©lÃ©charger :</h2>";

            participants.forEach((giver, i) => {
                const recipient = shuffled[i];
                const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Secret Santa pour ${giver.name}</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; padding: 50px; background: #f9f9f9; }
        .card {
            border: 2px dashed #c62828;
            padding: 30px;
            background: #fff8e1;
            max-width: 500px;
            margin: auto;
            border-radius: 10px;
        }
        h1 { color: #c62828; }
        p { font-size: 18px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ… Secret Santa ğŸ</h1>
        <p><strong>${giver.name}</strong>, tu dois offrir un cadeau Ã  :</p>
        <h2>${recipient.name}</h2>
        <p>Garde Ã§a secret ğŸ¤«</p>
        <p>Joyeux NoÃ«l ! ğŸ„</p>
    </div>
</body>
</html>
                `;

                const blob = new Blob([htmlContent], { type: "text/html" });
                const url = URL.createObjectURL(blob);

                const downloadLink = document.createElement("a");
                downloadLink.href = url;
                downloadLink.download = `Secret_Santa_${giver.name}.html`;
                downloadLink.innerText = `ğŸ“¥ TÃ©lÃ©charger pour ${giver.name}`;
                fileLinksDiv.appendChild(downloadLink);

                const subject = encodeURIComponent("ğŸ… Ton tirage Secret Santa !");
                const body = encodeURIComponent(`Bonjour ${giver.name},\n\nVoici le rÃ©sultat de ton tirage Secret Santa. Tu peux tÃ©lÃ©charger ton fichier ici :\n${url}\n\nN'oublie pas de garder le secret ğŸ˜‰\n\nJoyeux NoÃ«l ! ğŸ„`);
                const mailtoLink = document.createElement("a");
                mailtoLink.href = `mailto:${giver.email}?subject=${subject}&body=${body}`;
                mailtoLink.innerText = `âœ‰ï¸ Envoyer Ã  ${giver.name}`;
                fileLinksDiv.appendChild(mailtoLink);
            });

            // GÃ©nÃ©rer dynamiquement les liens vers les fichiers hÃ©bergÃ©s
            const hostedLinksContainer = document.getElementById("hostedLinksContainer");
            hostedLinksContainer.innerHTML = `
                <h2>ğŸ“ Liens vers les fichiers hÃ©bergÃ©s</h2>
                <p>Une fois les fichiers tÃ©lÃ©chargÃ©s dans le dossier <code>tirages/</code> de ton dÃ©pÃ´t GitHub Pages, les participants peuvent y accÃ©der via ces liens :</p>
            `;

            participants.forEach(giver => {
                const hostedLink = document.createElement("a");
                hostedLink.href = `${githubBaseURL}Secret_Santa_${giver.name}.html`;
                hostedLink.target = "_blank";
                hostedLink.innerText = `ğŸ Voir le tirage de ${giver.name}`;
                hostedLinksContainer.appendChild(hostedLink);
            });
        }
    </script>
</body>
</html>
